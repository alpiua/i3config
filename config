# original config by Pylypchuk Oleksii 

##############################     VARIABLES    ################################
set $mod Mod4

#set $display_up HDMI1
set $display_up DP1
set $display_left DP2

workspace_auto_back_and_forth no
font pango:DejaVu Sans Mono 9
#font pango:Cantarell 11
title_align center

#############################       STARTUP       ##############################

# Locale switching and mouse speed setting
exec_always --no-startup-id $HOME/.config/system_scripts/keyboard

# screen locker
exec --no-startup-id xidlehook --not-when-fullscreen --not-when-audio --timer 300 'i3lock-fancy-multimonitor -p; xkbgroup set num 0' ''
exec --no-startup-id /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1

# device notification
exec --no-startup-id udiskie -t &
exec --no-startup-id cbatticon BAT0 &

# compositor & conky
#exec_always --no-startup-id conky -b -d &
exec_always --no-startup-id picom -b --config $HOME/.config/picom/picom.conf --experimental-backends

# tray
exec --no-startup-id nm-applet
#exec --no-startup-id flameshot
exec --no-startup-id volumeicon &

# redshift
exec --no-startup-id redshift-gtk
exec --no-startup-id /usr/lib/geoclue-2.0/demos/agent10&

# background changer
exec --no-startup-id bash $HOME/.config/system_scripts/pkill_bc &


#############################      BINDINGS       ##############################

# Change locale by pressing a key
# Right_Shift > English
bindcode 62 exec --no-startup-id "xkbgroup set num 0; sleep 100"     
# Right_Alt > Russian
bindcode 108 exec --no-startup-id "xkbgroup set num 1; sleep 100"   
# Right_Ctrl > Ukrainian
bindcode 105 exec --no-startup-id "xkbgroup set num 2; sleep 100"    

# Some useful stuff
# empty buffer to remove accidental paste while clicking middle button
bindsym $mod+Delete exec --no-startup-id "echo '' | xclip -r -selection primary"
bindsym $mod+Insert focus output $display_up
bindsym $mod+End focus output primary
bindsym $mod+Home focus output $display_left

# Start Applications
bindsym $mod+Return "exec alacritty"
bindsym $mod+Shift+Return "exec i3-sensible-terminal"
bindcode $mod+51 "exec tilix -q"

# essentials
bindsym $mod+Ctrl+3 workspace $ws3, exec "calibre"
bindsym $mod+Ctrl+5 workspace $ws5, exec "trilium"
bindsym $mod+Ctrl+6 workspace $ws6, exec "nomacs"
bindsym $mod+Ctrl+7 workspace $ws7, exec "pcmanfm"
bindsym $mod+Ctrl+8 workspace $ws8, exec "telegram-desktop"
bindsym $mod+Ctrl+9 workspace $ws9, exec "GDK_SCALE=2 tutanota-desktop"
bindsym $mod+Ctrl+0 workspace $ws10, exec "LIBVA_DRIVER_NAME=iHD brave --high-dpi-support=1 --force-device-scale-factor=1.4 --ignore-gpu-blocklist --use-gl=desktop --enable-features=VaapiVideoDecoder --enable-zero-copy --enable-accelerated-video-decode --enable-gpu-rasterization --disable-gpu-driver-bug-workarounds"
# soft
bindsym $mod+Ctrl+F4 workspace $ws14, exec "winbox"
bindsym $mod+Ctrl+F5 workspace $ws15, exec "XMind2020 --force-device-scale-factor=1.4"
bindsym $mod+Ctrl+F6 workspace $ws16, exec "drawio --force-device-scale-factor=1.4"
#bindsym $mod+Ctrl+F6 workspace $ws16, exec "xournalpp"
# dhamma
bindsym $mod+Ctrl+F7 workspace $ws17, exec "microsoft-edge-stable --force-device-scale-factor=1.4"
bindsym $mod+Ctrl+F8 workspace $ws18, exec "teams-insiders --force-device-scale-factor=1.4"
# work
bindsym $mod+Ctrl+F9 workspace $ws19, exec "remmina -c ~/.local/share/remmina/group_rdp_t28_s-kv-center-t28-officekiev-fozzy-lan.remmina"
bindsym $mod+Ctrl+F10 workspace $ws20, exec "teams --force-device-scale-factor=1.4"
bindsym $mod+Ctrl+F11 workspace $ws21, exec "thunderbird"
bindsym $mod+Ctrl+F12 workspace $ws22, exec "firefox"

# Diff
bindsym $mod+Ctrl+c exec zenity --calendar
bindsym $mod+Mod1+c exec io.elementary.calculator
bindsym $mod+Ctrl+m exec pavucontrol-qt
bindsym $mod+Ctrl+f exec "QT_SCREEN_SCALE_FACTORS='1;1' flameshot gui"

# audio

bindsym XF86AudioPlay exec --no-startup-id bash $HOME/.config/system_scripts/volume pause
bindsym XF86AudioPrev exec --no-startup-id bash $HOME/.config/system_scripts/volume previous
bindsym XF86AudioNext exec --no-startup-id bash $HOME/.config/system_scripts/volume next
bindsym XF86AudioRaiseVolume exec --no-startup-id bash $HOME/.config/system_scripts/volume up
bindsym XF86AudioLowerVolume exec --no-startup-id bash $HOME/.config/system_scripts/volume down
bindsym XF86AudioMute exec --no-startup-id bash $HOME/.config/system_scripts/volume mute
bindsym XF86AudioMicMute exec --no-startup-id pactl set-source-mute @DEFAULT_SOURCE@ toggle

# Brightness bindings
bindsym XF86MonBrightnessUp exec --no-startup-id bash $HOME/.config/system_scripts/brightness up
bindsym XF86MonBrightnessDown exec --no-startup-id bash $HOME/.config/system_scripts/brightness down

#bindsym $mod+F8 		exec 	"xbacklight -ctrl ddcci6 -dec 10"
#bindsym $mod+F9 		exec 	"xbacklight -ctrl ddcci6 -inc 10"


#############################     I3_BINDIGS     ###############################
bindsym $mod+Shift+c reload
bindsym $mod+Shift+r restart
bindsym $mod+Shift+e exec "i3-nagbar -t warning -m 'Want to exit i3 and stop your X session?' -B 'Yes' 'i3-msg exit'"  # exit i3

# change focus
bindsym $mod+j focus left               
bindsym $mod+k focus down              
bindsym $mod+l focus up               
bindsym $mod+semicolon focus right   

# move focused window
bindsym $mod+Shift+j move left      
bindsym $mod+Shift+k move down     
bindsym $mod+Shift+l move up      
bindsym $mod+Shift+semicolon move right

# Mark window (not workspace) and goto mark
bindsym $mod+i exec i3-input -F 'mark %s' -l 1 -P 'Mark: '
bindsym $mod+o exec i3-input -F '[con_mark="%s"] focus' -l 1 -P 'Goto: '

# split & fullscreen & stacking
bindsym $mod+h split h
bindsym $mod+v split v
bindsym $mod+e layout toggle split
bindsym $mod+s layout stacking
bindsym $mod+w layout tabbed 
bindsym $mod+a focus parent
bindsym $mod+q focus child
bindsym $mod+f fullscreen toggle

# floating
bindsym $mod+t floating toggle           
bindsym $mod+space focus mode_toggle    
floating_modifier $mod

# scratchpad
bindsym $mod+Shift+minus move scratchpad
bindsym $mod+minus scratchpad show

# Rename workspace I3tags; show and move to workspace
bindsym $mod+n exec i3-input -F 'rename workspace to "%s"' -P 'New name: '
bindsym $mod+r exec "xkbgroup set num 0;$HOME/.config/i3/tags/i3-dtags.sh -fn '$dfont'"
bindsym $mod+m exec "xkbgroup set num 0;$HOME/.config/i3/tags/i3-dtags-moveto.sh -fn '$dfont'"

# Workspace travel
bindsym $mod+b workspace back_and_forth
bindcode $mod+34 workspace prev_on_output
bindcode $mod+35 workspace next_on_output
bindcode $mod+Shift+34 workspace prev
bindcode $mod+Shift+35 workspace next

# Move container
bindsym $mod+Shift+b move container to workspace back_and_forth
#bindcode $mod+59 move container to workspace prev
#bindcode $mod+60 move container to workspace next
#bindcode $mod+61 move container to workspace current

# Move workspace
bindsym $mod+z move workspace to output $display_left
bindsym $mod+c move workspace to output $display_up
bindsym $mod+x move workspace to output primary

# Kill bindings: notification, deadly cursor, kill focused window
bindsym $mod+Shift+d --release exec "killall dunst; exec notify-send 'restart dunst'"
bindsym $mod+Ctrl+x --release exec --no-startup-id xkill
bindsym $mod+Shift+q kill               

# Backup
bindsym $mod+Ctrl+b exec --no-startup-id "$HOME/.config/system_scripts/backup; exec notify-send 'Dotfiles backup completed'"

# Change wallpaper
bindsym $mod+Shift+w exec --no-startup-id "$HOME/.config/system_scripts/pkill_bc"

# Configure display
bindsym $mod+Ctrl+d exec --no-startup-id "$HOME/.config/system_scripts/display"


##############################       BAR       #################################

bar {
      	i3bar_command i3bar
        status_command i3status-rs .config/i3/i3status-rs.toml
        #status_command i3status -c $HOME/.config/i3/i3status.conf
        tray_output primary
	      position bottom
	      font xft:URWGothic-Book 10

    colors {
        background #222D31
        statusline #F9FAF9
	      separator  #ffff00

        #                   border  backgr   text
        focused_workspace  #F9FAF9 #16a085 #292F34
        active_workspace   #595B5B #353836 #FDF6E3
        inactive_workspace #595B5B #222D31 #EEE8D5
        binding_mode       #16a085 #2C2C2C #F9FAF9
        urgent_workspace   #16a085 #FDF6E3 #E5201D
    }
}


##############################    WORKSPACES    ################################

# Define names for default workspaces
set $ws1 "1. "
set $ws2 "2. "
set $ws3 "3. books"
set $ws4 "4. tasks "
set $ws5 "5. note "
set $ws6 "6. images "
set $ws7 "7. files "
set $ws8 "8. telegram "
set $ws9 "9. tutanota "
set $ws10 "10 brave "
set $ws11 "11 wt "
set $ws12 "12 wt "
set $ws13 "13  "
set $ws14 "14 winbox "
set $ws15 "15 mindmap "
set $ws16 "16 drawio "
set $ws17 "17 edge "
set $ws18 "18 teams-dhamma "
set $ws19 "19 remmina "
set $ws20 "20 teams-fozzy "
set $ws21 "21 mail-fozzy "
set $ws22 "22 firefox "

# Defaults
workspace $ws1 output primary
workspace $ws2 output primary
workspace $ws3 output $display_left
workspace $ws4 output primary
workspace $ws5 output $display_left
workspace $ws6 output primary
workspace $ws7 output primary
workspace $ws8 output primary
workspace $ws9 output primary
workspace $ws10 output $display_left
workspace $ws11 output $display_up
workspace $ws12 output $display_up
workspace $ws13 output $display_up
workspace $ws14 output $display_up
workspace $ws15 output $display_up
workspace $ws16 output $display_up
workspace $ws17 output $display_up
workspace $ws18 output $display_up
workspace $ws19 output $display_up
workspace $ws20 output primary
workspace $ws21 output primary
workspace $ws22 output $display_left

# switch to workspace
bindsym $mod+1 workspace number $ws1
bindsym $mod+2 workspace number $ws2
bindsym $mod+3 workspace number $ws3
bindsym $mod+4 workspace number $ws4
bindsym $mod+5 workspace number $ws5
bindsym $mod+6 workspace number $ws6
bindsym $mod+7 workspace number $ws7
bindsym $mod+8 workspace number $ws8 exec xdg-settings set default-web-browser brave-browser.desktop
bindsym $mod+9 workspace number $ws9
bindsym $mod+0 workspace number $ws10 exec xdg-settings set default-web-browser brave-browser.desktop
bindsym $mod+F1 workspace number $ws11
bindsym $mod+F2 workspace number $ws12
bindsym $mod+F3 workspace number $ws13
bindsym $mod+F4 workspace number $ws14
bindsym $mod+F5 workspace number $ws15
bindsym $mod+F6 workspace number $ws16
bindsym $mod+F7 workspace number $ws17 exec xdg-settings set default-web-browser microsoft-edge.desktop
bindsym $mod+F8 workspace number $ws18 exec xdg-settings set default-web-browser microsoft-edge.desktop
bindsym $mod+F9 workspace number $ws19
bindsym $mod+F10 workspace number $ws20 exec xdg-settings set default-web-browser firefox.desktop;
bindsym $mod+F11 workspace number $ws21 exec xdg-settings set default-web-browser firefox.desktop
bindsym $mod+F12 workspace number $ws22

# move focused container to workspace
bindsym $mod+Shift+1 move container to workspace number $ws1
bindsym $mod+Shift+2 move container to workspace number $ws2
bindsym $mod+Shift+3 move container to workspace number $ws3
bindsym $mod+Shift+4 move container to workspace number $ws4
bindsym $mod+Shift+5 move container to workspace number $ws5
bindsym $mod+Shift+6 move container to workspace number $ws6
bindsym $mod+Shift+7 move container to workspace number $ws7
bindsym $mod+Shift+8 move container to workspace number $ws8
bindsym $mod+Shift+9 move container to workspace number $ws9
bindsym $mod+Shift+0 move container to workspace number $ws10
bindsym $mod+Shift+F1 move container to workspace number $ws11
bindsym $mod+Shift+F2 move container to workspace number $ws12
bindsym $mod+Shift+F3 move container to workspace number $ws13
bindsym $mod+Shift+F4 move container to workspace number $ws14
bindsym $mod+Shift+F5 move container to workspace number $ws15
bindsym $mod+Shift+F6 move container to workspace number $ws16
bindsym $mod+Shift+F7 move container to workspace number $ws17
bindsym $mod+Shift+F8 move container to workspace number $ws18
bindsym $mod+Shift+F9 move container to workspace number $ws19
bindsym $mod+Shift+F10 move container to workspace number $ws20
bindsym $mod+Shift+F11 move container to workspace number $ws21
bindsym $mod+Shift+F12 move container to workspace number $ws22

# Open specific applications in floating mode 
for_window [class="GParted"] floating enable border normal
for_window [class="qt5ct"] floating enable sticky enable border normal
for_window [class="Nitrogen"] floating enable sticky enable border normal
#for_window [class="Simple-scan"] floating enable border normal
#for_window [class="Skype"] floating enable border normal


##############################       MENU       ################################

# Rofi
bindsym $mod+Ctrl+s exec "xkbgroup set num 0;rofi -show ssh"
bindsym $mod+Tab    exec "xkbgroup set num 0;rofi -show window"
bindsym $mod+d exec --no-startup-id rofi -show drun -theme ~/.config/rofi/rofi-i3.rasi
bindsym $mod+Shift+p exec --no-startup-id bash ~/.config/rofi/leave/powermenu.sh


# categorized menu
bindsym $mod+u exec --no-startup-id morc_menu 
bindsym $mod+Ctrl+y exec terminal -e 'bmenu'


# take a screenshot with scrot, put it in Desktop folder
set $scrot_capture scrot 'screenshot-%Y-%m-%d_%H-%M-%S.png' -e 'mv $f ~/Pictures/'
set $scrot_region scrot -s 'screenshot-%Y-%m-%d_%H-%M-%S.png' -e 'mv $f ~/Pictures/screenshots'
set $scrot_region_cb scrot -s -o '/tmp/screenshot' -e 'xclip -selection clipboard -t image/png -i $f'
set $scrot_focus scrot -u 'screenshot-%Y-%m-%d_%H-%M-%S.png' -e 'mv $f ~/Pictures/screenshots'
set $scrot_focus_cb scrot -u 'screenshot_clipboard' -e 'xclip -selection clipboard -t image/png -i $f'
set $flameshot "QT_SCREEN_SCALE_FACTORS='1;1' flameshot launcher"

mode "$mode_screenshot" {
        bindsym Return      exec --no-startup-id $scrot_capture && notify-send "Screenshot saved in your Pictures folder", mode "default"
        bindsym --release ctrl+s exec --no-startup-id $scrot_region && notify-send "Screenshot saved in your Pictures folder", mode "default"
        bindsym --release s exec --no-startup-id $scrot_region_cb && notify-send "Screenshot saved to clipboard", mode "default"
        bindsym --release ctrl+f exec --no-startup-id $scrot_focus && notify-send "Screenshot saved in your Pictures folder", mode "default"
        bindsym --release f exec --no-startup-id $scrot_focus_cb && notify-send "Screenshot saved to clipboard", mode "default"
        bindsym --release p exec --no-startup-id $flameshot, mode "default"
        bindsym Escape      mode "default"
}
set $mode_screenshot Screenshot: (Enter) Save all, (S) Select to clip, (F) Focused to clip, (Ctrl+S) Save select, (Ctrl+F) Save focused, (P) Edit capture
bindsym $mod+P mode "$mode_screenshot"


mode "$touch_to_screen" {
        bindsym Return exec --no-startup-id ~/.config/system_scripts/rotate_touch eDP1 normal && notify-send "touch is now on primary screen", mode "default"
        bindsym 1 exec --no-startup-id ~/.config/system_scripts/rotate_touch DP1 invert && notify-send "touch is now on top screen", mode "default"
        bindsym 2 exec --no-startup-id ~/.config/system_scripts/rotate_touch DP2 left && notify-send "touch is now on left screen", mode "default"
        bindsym 3 exec --no-startup-id ~/.config/system_scripts/rotate_touch DP2 normal && notify-send "touch is now on left screen", mode "default"
        bindsym Escape      mode "default"
}
set $touch_to_screen Use touch with: (Enter) Default, (1) DP1 invert, (2) DP2 left, (3) DP2 normal
bindsym $mod+Shift+o mode "$touch_to_screen"


# PASSWORD MENU
set $dmenu_pass gopass ls --flat | rofi -dmenu -i -theme ~/.config/rofi/rofi-gopass.rasi
bindsym $mod+Print exec --no-startup-id "xkbgroup set num 0; $dmenu_pass | xargs --no-run-if-empty gopass show -c"

mode "$gopass_menu" {
        bindsym Return mode "default"
        bindsym --release Mod1+n exec --no-startup-id "$HOME/.config/system_scripts/gopass username"
        bindsym --release Mod1+p exec --no-startup-id "$HOME/.config/system_scripts/gopass pass"
        bindsym --release Mod1+u exec --no-startup-id "$HOME/.config/system_scripts/gopass url"
        bindsym --release Mod1+c exec --no-startup-id "$HOME/.config/system_scripts/gopass clipboard"
        bindsym --release Mod1+e exec --no-startup-id "$HOME/.config/system_scripts/gopass entry"
        bindsym --release Mod1+z mode "default"
        bindsym Escape mode "default"
}
set $gopass_menu Press to fill Alt + [e]ntry / user[n]ame / [u]rl / [p]assword / [c] to copy pass to clipboard
bindsym $mod+Mod1+Print exec --no-startup-id "xkbgroup set num 0;$HOME/.config/system_scripts/gopass get-item"; mode "$gopass_menu"


# resize window 
mode "resize" {
        bindsym j resize shrink width 5 px or 5 ppt
        bindsym k resize grow height 5 px or 5 ppt
        bindsym l resize shrink height 5 px or 5 ppt
        bindsym semicolon resize grow width 5 px or 5 ppt

        bindsym Return mode "default"
        bindsym Escape mode "default"
}
bindsym $mod+Ctrl+r mode "resize"


##############################       GAPS       ################################

title_align left
hide_edge_borders smart
default_border normal

bindsym $mod+g border toggle

# Set inner/outer gaps #
gaps inner 10
gaps outer 0

smart_gaps on
smart_borders no_gaps

# Press $mod+Shift+g to enter the gap mode. 
# Choose o or i for modifying outer/inner gaps. 
# Press one of + / - (in-/decrement for current workspace) or 0 (remove gaps for current workspace).
# If you also press Shift with these keys, the change will be global for all workspaces.

set $mode_gaps Gaps: (o) outer, (i) inner
set $mode_gaps_outer Outer Gaps: +|-|0 (local), Shift + +|-|0 (global)
set $mode_gaps_inner Inner Gaps: +|-|0 (local), Shift + +|-|0 (global)
bindsym $mod+Shift+g mode "$mode_gaps"

mode "$mode_gaps" {
        bindsym o      mode "$mode_gaps_outer"
        bindsym i      mode "$mode_gaps_inner"
        bindsym Return mode "default"
        bindsym Escape mode "default"
}
mode "$mode_gaps_inner" {
        bindsym plus  gaps inner current plus 5
        bindsym minus gaps inner current minus 5
        bindsym 0     gaps inner current set 0

        bindsym Shift+plus  gaps inner all plus 5
        bindsym Shift+minus gaps inner all minus 5
        bindsym Shift+0     gaps inner all set 0

        bindsym Return mode "default"
        bindsym Escape mode "default"
}
mode "$mode_gaps_outer" {
        bindsym plus  gaps outer current plus 5
        bindsym minus gaps outer current minus 5
        bindsym 0     gaps outer current set 0

        bindsym Shift+plus  gaps outer all plus 5
        bindsym Shift+minus gaps outer all minus 5
        bindsym Shift+0     gaps outer all set 0

        bindsym Return mode "default"
        bindsym Escape mode "default"
}
for_window [class=".*"] border pixel 2
